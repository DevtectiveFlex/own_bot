# Telegram Bot — «Своя Игра»

Telegram-бот для управления интеллектуальной игрой в формате «Своя игра».

Бот является **единственным управляющим интерфейсом игрового процесса** и
используется ведущим и игроками для выполнения всех игровых действий.

Веб-интерфейсы (административный интерфейс и экран показа) **не управляют игрой**
и используются исключительно для отображения состояния игры и подготовки контента.

---

## Назначение бота

Бот выполняет следующие функции:

- управление игровым процессом
- приём ответов игроков
- фиксация времени ответов
- подсчёт и изменение очков
- изменение состояния игры

Бот напрямую взаимодействует с базой данных и является
**единственным компонентом системы, изменяющим игровое состояние**.

---

## Общая архитектура

```
Игрок / Ведущий (Telegram)
        |
        v
Telegram Webhook
        |
        v
Bot (Serverless Handler)
        |
        v
Database (PostgreSQL)
        |
        v
Realtime Updates
        |
        v
Web Display / Admin Interface
```

Основные принципы:

- режим работы: webhook
- серверное выполнение (serverless)
- хранение состояния в базе данных
- клиентское время не используется

---

## Технологический стек

Фактический стек может быть уточнён и дополнен.

- Node.js (версия указывается)
- TypeScript
- Telegram Bot API SDK (указать библиотеку)
- Serverless Functions (указать платформу)
- PostgreSQL
- ORM / Query Builder (указать используемый инструмент)

---

## Роли пользователей

### Ведущий

- запуск и завершение игры
- открытие вопросов
- управление таймером
- раскрытие ответов
- начисление и снятие очков

### Игрок

- отправка ответов в личные сообщения боту
- просмотр очков команды
- просмотр личной статистики

### Капитан команды

(расширение роли игрока)

- подтверждение финального ответа команды
- изменение названия команды
- управление аватаром команды

---

## Команды бота

### Команды ведущего

Список команд уточняется:

```
/start_game
/new_round
/open_question
/show_answers
/add_points
/remove_points
/finish_game
```

### Команды игрока

```
/my_score
/my_answers
/my_stats
```

Финальный список и формат команд может быть изменён.

---

## Работа со временем

Важно:

- клиентское время не используется
- временные метки из Telegram не используются как источник истины
- все временные значения фиксируются на сервере или на уровне базы данных

Пример расчёта времени ответа:

```
response_time = submitted_at - question_started_at
```

Источник времени определяется при реализации.

---

## Безопасность

Общие принципы безопасности:

- бот использует сервисный доступ к базе данных
- доступы к данным ограничены на уровне БД
- веб-интерфейсы не имеют прав на изменение состояния игры
- все критические действия выполняются только через бота

Конкретная модель безопасности уточняется при реализации.

---

## Структура проекта

Актуальная структура может отличаться и уточняется в процессе разработки.

```
src/
├─ bot.ts              # точка входа webhook
├─ commands/           # команды Telegram
├─ keyboards/          # inline-клавиатуры
├─ handlers/           # обработчики событий
├─ services/           # работа с базой данных
├─ core/               # бизнес-логика игры
└─ types/              # типы и контракты
```

---

## Переменные окружения

Фактический список переменных определяется при реализации.

Пример:

```env
BOT_TOKEN=
DATABASE_URL=
SERVICE_ROLE_KEY=
WEBHOOK_URL=
```

---

## Локальная разработка

Общий процесс локальной разработки:

1. Установка зависимостей
2. Запуск локального сервера
3. Проброс webhook на локальную машину
4. Регистрация webhook в Telegram

Конкретные команды указываются после выбора инструментов.

---

## Ограничения

На текущий момент предполагаются следующие ограничения:

- отсутствует long polling
- отсутствует хранение состояния в памяти процесса
- отсутствуют клиентские таймеры
- управление игрой осуществляется только через Telegram

---

## Возможные расширения

Реализация следующих возможностей не входит в базовую версию:

- дополнительные типы раундов
- рейтинги команд
- сезоны и турниры
- Telegram Mini App
- расширенная статистика

---

## Лицензия

Тип лицензии: указать

---

## Статус проекта

Проект находится в стадии разработки.  
Требования и архитектура могут уточняться.
